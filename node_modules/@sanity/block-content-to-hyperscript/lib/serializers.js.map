{"version":3,"sources":["../src/serializers.js"],"names":["objectAssign","require","getImageUrl","module","exports","h","serializerOpts","serializeOptions","useDashedStyles","BlockSerializer","props","node","serializers","options","isInline","children","blockType","_type","serializer","types","ignoreUnknownTypes","console","warn","unknownType","Error","SpanSerializer","mark","isPlain","markType","marks","unknownMark","ListSerializer","tag","type","ListItemSerializer","style","block","DefaultUnknownTypeSerializer","display","BlockTypeSerializer","test","RawMarkSerializer","UnderlineSerializer","textDecoration","StrikeThroughSerializer","LinkSerializer","href","ImageSerializer","asset","img","src","serializeSpan","span","index","hardBreak","key","text","map","child","i","serializeNode","serializedNode","_key","HardBreakSerializer","defaultMarkSerializers","strong","bind","em","code","underline","link","defaultSerializers","image","list","listItem","container","undefined","empty"],"mappings":"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","sourcesContent":["const objectAssign = require('object-assign')\nconst getImageUrl = require('./getImageUrl')\n\nmodule.exports = (h, serializerOpts) => {\n  const serializeOptions = serializerOpts || {useDashedStyles: false}\n\n  // Low-level block serializer\n  function BlockSerializer(props) {\n    const {node, serializers, options, isInline, children} = props\n    const blockType = node._type\n    const serializer = serializers.types[blockType]\n    if (!serializer) {\n      if (options.ignoreUnknownTypes) {\n        // eslint-disable-next-line no-console\n        console.warn(\n          `Unknown block type \"${blockType}\", please specify a serializer for it in the \\`serializers.types\\` prop`\n        )\n        return h(serializers.unknownType, {node, options, isInline}, children)\n      }\n      throw new Error(\n        `Unknown block type \"${blockType}\", please specify a serializer for it in the \\`serializers.types\\` prop`\n      )\n    }\n\n    return h(serializer, {node, options, isInline}, children)\n  }\n\n  // Low-level span serializer\n  function SpanSerializer(props) {\n    const {mark, children} = props.node\n    const isPlain = typeof mark === 'string'\n    const markType = isPlain ? mark : mark._type\n    const serializer = props.serializers.marks[markType]\n    if (!serializer) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `Unknown mark type \"${markType}\", please specify a serializer for it in the \\`serializers.marks\\` prop`\n      )\n      return h(props.serializers.unknownMark, null, children)\n    }\n\n    return h(serializer, props.node, children)\n  }\n\n  // Low-level list serializer\n  function ListSerializer(props) {\n    const tag = props.type === 'bullet' ? 'ul' : 'ol'\n    return h(tag, null, props.children)\n  }\n\n  // Low-level list item serializer\n  function ListItemSerializer(props) {\n    const children =\n      !props.node.style || props.node.style === 'normal'\n        ? // Don't wrap plain text in paragraphs inside of a list item\n          props.children\n        : // But wrap any other style in whatever the block serializer says to use\n          h(props.serializers.types.block, props, props.children)\n\n    return h('li', null, children)\n  }\n\n  // Unknown type default serializer\n  function DefaultUnknownTypeSerializer(props) {\n    return h(\n      'div',\n      {style: {display: 'none'}},\n      `Unknown block type \"${\n        props.node._type\n      }\", please specify a serializer for it in the \\`serializers.types\\` prop`\n    )\n  }\n\n  // Renderer of an actual block of type `block`. Confusing, we know.\n  function BlockTypeSerializer(props) {\n    const style = props.node.style || 'normal'\n\n    if (/^h\\d/.test(style)) {\n      return h(style, null, props.children)\n    }\n\n    return style === 'blockquote'\n      ? h('blockquote', null, props.children)\n      : h('p', null, props.children)\n  }\n\n  // Serializers for things that can be directly attributed to a tag without any props\n  // We use partial application to do this, passing the tag name as the first argument\n  function RawMarkSerializer(tag, props) {\n    return h(tag, null, props.children)\n  }\n\n  function UnderlineSerializer(props) {\n    const style = serializeOptions.useDashedStyles\n      ? {'text-decoration': 'underline'}\n      : {textDecoration: 'underline'}\n\n    return h('span', {style}, props.children)\n  }\n\n  function StrikeThroughSerializer(props) {\n    return h('del', null, props.children)\n  }\n\n  function LinkSerializer(props) {\n    return h('a', {href: props.mark.href}, props.children)\n  }\n\n  function ImageSerializer(props) {\n    if (!props.node.asset) {\n      return null\n    }\n\n    const img = h('img', {src: getImageUrl(props)})\n    return props.isInline ? img : h('figure', null, img)\n  }\n\n  // Serializer that recursively calls itself, producing a hyperscript tree of spans\n  function serializeSpan(span, serializers, index, options) {\n    if (span === '\\n' && serializers.hardBreak) {\n      return h(serializers.hardBreak, {key: `hb-${index}`})\n    }\n\n    if (typeof span === 'string') {\n      return serializers.text ? h(serializers.text, {key: `text-${index}`}, span) : span\n    }\n\n    let children\n    if (span.children) {\n      children = {\n        children: span.children.map((child, i) =>\n          options.serializeNode(child, i, span.children, true)\n        )\n      }\n    }\n\n    const serializedNode = objectAssign({}, span, children)\n\n    return h(serializers.span, {\n      key: span._key || `span-${index}`,\n      node: serializedNode,\n      serializers\n    })\n  }\n\n  const HardBreakSerializer = () => h('br')\n  const defaultMarkSerializers = {\n    strong: RawMarkSerializer.bind(null, 'strong'),\n    em: RawMarkSerializer.bind(null, 'em'),\n    code: RawMarkSerializer.bind(null, 'code'),\n    underline: UnderlineSerializer,\n    'strike-through': StrikeThroughSerializer,\n    link: LinkSerializer\n  }\n\n  const defaultSerializers = {\n    // Common overrides\n    types: {\n      block: BlockTypeSerializer,\n      image: ImageSerializer\n    },\n    marks: defaultMarkSerializers,\n\n    // Less common overrides\n    list: ListSerializer,\n    listItem: ListItemSerializer,\n\n    block: BlockSerializer,\n    span: SpanSerializer,\n    hardBreak: HardBreakSerializer,\n\n    unknownType: DefaultUnknownTypeSerializer,\n    unknownMark: 'span',\n\n    // Container element\n    container: 'div',\n\n    // Allow overriding text renderer, but leave undefined to just use plain strings by default\n    text: undefined,\n\n    // Empty nodes (React uses null, hyperscript with empty strings)\n    empty: ''\n  }\n\n  return {\n    defaultSerializers,\n    serializeSpan\n  }\n}\n"],"file":"serializers.js"}