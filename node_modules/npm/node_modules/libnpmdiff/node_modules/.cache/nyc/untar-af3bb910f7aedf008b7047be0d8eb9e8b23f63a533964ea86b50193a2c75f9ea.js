function cov_1mr6be157v(){var path="/Users/ruyadorno/Documents/workspace/cli/main/packages/libnpmdiff/lib/untar.js";var hash="e808cb0bc21493ba77d94876bfc19b2f78e4b804";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/ruyadorno/Documents/workspace/cli/main/packages/libnpmdiff/lib/untar.js",statementMap:{"0":{start:{line:1,column:12},end:{line:1,column:26}},"1":{start:{line:2,column:18},end:{line:2,column:38}},"2":{start:{line:4,column:23},end:{line:6,column:27}},"3":{start:{line:4,column:30},end:{line:6,column:27}},"4":{start:{line:10,column:14},end:{line:62,column:1}},"5":{start:{line:11,column:2},end:{line:61,column:14}},"6":{start:{line:13,column:24},end:{line:22,column:13}},"7":{start:{line:14,column:9},end:{line:22,column:12}},"8":{start:{line:16,column:28},end:{line:16,column:45}},"9":{start:{line:17,column:12},end:{line:21,column:13}},"10":{start:{line:25,column:26},end:{line:28,column:74}},"11":{start:{line:26,column:8},end:{line:28,column:74}},"12":{start:{line:27,column:10},end:{line:28,column:73}},"13":{start:{line:30,column:6},end:{line:55,column:7}},"14":{start:{line:34,column:20},end:{line:34,column:49}},"15":{start:{line:35,column:8},end:{line:35,column:22}},"16":{start:{line:39,column:8},end:{line:48,column:9}},"17":{start:{line:40,column:10},end:{line:40,column:35}},"18":{start:{line:41,column:10},end:{line:41,column:34}},"19":{start:{line:50,column:8},end:{line:53,column:10}},"20":{start:{line:54,column:8},end:{line:54,column:19}},"21":{start:{line:64,column:21},end:{line:94,column:1}},"22":{start:{line:65,column:16},end:{line:65,column:25}},"23":{start:{line:66,column:15},end:{line:66,column:24}},"24":{start:{line:67,column:14},end:{line:67,column:33}},"25":{start:{line:69,column:22},end:{line:69,column:42}},"26":{start:{line:71,column:2},end:{line:80,column:3}},"27":{start:{line:72,column:4},end:{line:79,column:6}},"28":{start:{line:83,column:18},end:{line:83,column:36}},"29":{start:{line:84,column:19},end:{line:84,column:75}},"30":{start:{line:84,column:62},end:{line:84,column:73}},"31":{start:{line:86,column:2},end:{line:88,column:4}},"32":{start:{line:87,column:4},end:{line:87,column:36}},"33":{start:{line:90,column:2},end:{line:93,column:3}},"34":{start:{line:96,column:0},end:{line:96,column:29}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:4,column:23},end:{line:4,column:24}},loc:{start:{line:4,column:30},end:{line:6,column:27}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:10,column:14},end:{line:10,column:15}},loc:{start:{line:10,column:66},end:{line:62,column:1}},line:10},"2":{name:"(anonymous_2)",decl:{start:{line:12,column:12},end:{line:12,column:13}},loc:{start:{line:12,column:29},end:{line:56,column:5}},line:12},"3":{name:"(anonymous_3)",decl:{start:{line:13,column:24},end:{line:13,column:25}},loc:{start:{line:14,column:9},end:{line:22,column:12}},line:14},"4":{name:"(anonymous_4)",decl:{start:{line:15,column:27},end:{line:15,column:28}},loc:{start:{line:15,column:32},end:{line:22,column:11}},line:15},"5":{name:"(anonymous_5)",decl:{start:{line:25,column:26},end:{line:25,column:27}},loc:{start:{line:26,column:8},end:{line:28,column:74}},line:26},"6":{name:"(anonymous_6)",decl:{start:{line:26,column:25},end:{line:26,column:26}},loc:{start:{line:27,column:10},end:{line:28,column:73}},line:27},"7":{name:"(anonymous_7)",decl:{start:{line:64,column:21},end:{line:64,column:22}},loc:{start:{line:64,column:52},end:{line:94,column:1}},line:64},"8":{name:"(anonymous_8)",decl:{start:{line:84,column:49},end:{line:84,column:50}},loc:{start:{line:84,column:62},end:{line:84,column:73}},line:84},"9":{name:"(anonymous_9)",decl:{start:{line:86,column:19},end:{line:86,column:20}},loc:{start:{line:86,column:39},end:{line:88,column:3}},line:86}},branchMap:{"0":{loc:{start:{line:14,column:9},end:{line:22,column:12}},type:"binary-expr",locations:[{start:{line:14,column:9},end:{line:14,column:28}},{start:{line:15,column:10},end:{line:22,column:12}}],line:14},"1":{loc:{start:{line:27,column:10},end:{line:28,column:73}},type:"binary-expr",locations:[{start:{line:27,column:10},end:{line:27,column:60}},{start:{line:28,column:10},end:{line:28,column:73}}],line:27},"2":{loc:{start:{line:30,column:6},end:{line:55,column:7}},type:"if",locations:[{start:{line:30,column:6},end:{line:55,column:7}},{start:{line:30,column:6},end:{line:55,column:7}}],line:30},"3":{loc:{start:{line:31,column:8},end:{line:32,column:38}},type:"binary-expr",locations:[{start:{line:31,column:8},end:{line:31,column:29}},{start:{line:32,column:9},end:{line:32,column:20}},{start:{line:32,column:24},end:{line:32,column:37}}],line:31},"4":{loc:{start:{line:64,column:38},end:{line:64,column:47}},type:"default-arg",locations:[{start:{line:64,column:45},end:{line:64,column:47}}],line:64},"5":{loc:{start:{line:69,column:22},end:{line:69,column:42}},type:"binary-expr",locations:[{start:{line:69,column:22},end:{line:69,column:36}},{start:{line:69,column:40},end:{line:69,column:42}}],line:69}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0,0],"4":[0],"5":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"e808cb0bc21493ba77d94876bfc19b2f78e4b804"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1mr6be157v=function(){return actualCoverage;};}return actualCoverage;}cov_1mr6be157v();const tar=(cov_1mr6be157v().s[0]++,require('tar'));const minimatch=(cov_1mr6be157v().s[1]++,require('minimatch'));cov_1mr6be157v().s[2]++;const normalizeMatch=str=>{cov_1mr6be157v().f[0]++;cov_1mr6be157v().s[3]++;return str.replace(/\\+/g,'/').replace(/^\.\/|^\./,'');};// files and refs are mutating params
// filterFiles, item, prefix and opts are read-only options
cov_1mr6be157v().s[4]++;const untar=({files,refs},{filterFiles,item,prefix})=>{cov_1mr6be157v().f[1]++;cov_1mr6be157v().s[5]++;tar.list({filter:(path,entry)=>{cov_1mr6be157v().f[2]++;cov_1mr6be157v().s[6]++;const fileMatch=()=>{cov_1mr6be157v().f[3]++;cov_1mr6be157v().s[7]++;return(cov_1mr6be157v().b[0][0]++,!filterFiles.length)||(cov_1mr6be157v().b[0][1]++,filterFiles.some(f=>{cov_1mr6be157v().f[4]++;const pattern=(cov_1mr6be157v().s[8]++,normalizeMatch(f));cov_1mr6be157v().s[9]++;return minimatch(normalizeMatch(path),`{package/,}${pattern}`,{matchBase:pattern.startsWith('*')});}));};// expands usage of simple path filters, e.g: lib or src/
cov_1mr6be157v().s[10]++;const folderMatch=()=>{cov_1mr6be157v().f[5]++;cov_1mr6be157v().s[11]++;return filterFiles.some(f=>{cov_1mr6be157v().f[6]++;cov_1mr6be157v().s[12]++;return(cov_1mr6be157v().b[1][0]++,normalizeMatch(path).startsWith(normalizeMatch(f)))||(cov_1mr6be157v().b[1][1]++,normalizeMatch(path).startsWith(`package/${normalizeMatch(f)}`));});};cov_1mr6be157v().s[13]++;if((cov_1mr6be157v().b[3][0]++,entry.type==='File')&&((cov_1mr6be157v().b[3][1]++,fileMatch())||(cov_1mr6be157v().b[3][2]++,folderMatch()))){cov_1mr6be157v().b[2][0]++;const key=(cov_1mr6be157v().s[14]++,path.replace(/^[^/]+\/?/,''));cov_1mr6be157v().s[15]++;files.add(key);// should skip reading file when using --name-only option
let content;cov_1mr6be157v().s[16]++;try{cov_1mr6be157v().s[17]++;entry.setEncoding('utf8');cov_1mr6be157v().s[18]++;content=entry.concat();}catch(e){/* istanbul ignore next */throw Object.assign(new Error('failed to read files'),{code:'EDIFFUNTAR'});}cov_1mr6be157v().s[19]++;refs.set(`${prefix}${key}`,{content,mode:`100${entry.mode.toString(8)}`});cov_1mr6be157v().s[20]++;return true;}else{cov_1mr6be157v().b[2][1]++;}}}).on('error',/* istanbul ignore next */e=>{throw e;}).end(item);};cov_1mr6be157v().s[21]++;const readTarballs=async(tarballs,opts=(cov_1mr6be157v().b[4][0]++,{}))=>{cov_1mr6be157v().f[7]++;const files=(cov_1mr6be157v().s[22]++,new Set());const refs=(cov_1mr6be157v().s[23]++,new Map());const arr=(cov_1mr6be157v().s[24]++,[].concat(tarballs));const filterFiles=(cov_1mr6be157v().s[25]++,(cov_1mr6be157v().b[5][0]++,opts.diffFiles)||(cov_1mr6be157v().b[5][1]++,[]));cov_1mr6be157v().s[26]++;for(const i of arr){cov_1mr6be157v().s[27]++;untar({files,refs},{item:i.item,prefix:i.prefix,filterFiles});}// await to read all content from included files
const allRefs=(cov_1mr6be157v().s[28]++,[...refs.values()]);const contents=(cov_1mr6be157v().s[29]++,await Promise.all(allRefs.map(async ref=>{cov_1mr6be157v().f[8]++;cov_1mr6be157v().s[30]++;return ref.content;})));cov_1mr6be157v().s[31]++;contents.forEach((content,index)=>{cov_1mr6be157v().f[9]++;cov_1mr6be157v().s[32]++;allRefs[index].content=content;});cov_1mr6be157v().s[33]++;return{files,refs};};cov_1mr6be157v().s[34]++;module.exports=readTarballs;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVudGFyLmpzIl0sIm5hbWVzIjpbInRhciIsInJlcXVpcmUiLCJtaW5pbWF0Y2giLCJub3JtYWxpemVNYXRjaCIsInN0ciIsInJlcGxhY2UiLCJ1bnRhciIsImZpbGVzIiwicmVmcyIsImZpbHRlckZpbGVzIiwiaXRlbSIsInByZWZpeCIsImxpc3QiLCJmaWx0ZXIiLCJwYXRoIiwiZW50cnkiLCJmaWxlTWF0Y2giLCJsZW5ndGgiLCJzb21lIiwiZiIsInBhdHRlcm4iLCJtYXRjaEJhc2UiLCJzdGFydHNXaXRoIiwiZm9sZGVyTWF0Y2giLCJ0eXBlIiwia2V5IiwiYWRkIiwiY29udGVudCIsInNldEVuY29kaW5nIiwiY29uY2F0IiwiZSIsIk9iamVjdCIsImFzc2lnbiIsIkVycm9yIiwiY29kZSIsInNldCIsIm1vZGUiLCJ0b1N0cmluZyIsIm9uIiwiZW5kIiwicmVhZFRhcmJhbGxzIiwidGFyYmFsbHMiLCJvcHRzIiwiU2V0IiwiTWFwIiwiYXJyIiwiZGlmZkZpbGVzIiwiaSIsImFsbFJlZnMiLCJ2YWx1ZXMiLCJjb250ZW50cyIsIlByb21pc2UiLCJhbGwiLCJtYXAiLCJyZWYiLCJmb3JFYWNoIiwiaW5kZXgiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoibWdMQWVZOzJGQWZaLEtBQU1BLENBQUFBLEdBQUcsMEJBQUdDLE9BQU8sQ0FBQyxLQUFELENBQVYsQ0FBVCxDQUNBLEtBQU1DLENBQUFBLFNBQVMsMEJBQUdELE9BQU8sQ0FBQyxXQUFELENBQVYsQ0FBZixDLHdCQUVBLEtBQU1FLENBQUFBLGNBQWMsQ0FBR0MsR0FBRyxFQUFJLHVEQUFBQSxDQUFBQSxHQUFHLENBQzlCQyxPQUQyQixDQUNuQixNQURtQixDQUNYLEdBRFcsRUFFM0JBLE9BRjJCLENBRW5CLFdBRm1CLENBRU4sRUFGTSxFQUVILENBRjNCLENBSUE7QUFDQTt3QkFDQSxLQUFNQyxDQUFBQSxLQUFLLENBQUcsQ0FBQyxDQUFFQyxLQUFGLENBQVNDLElBQVQsQ0FBRCxDQUFr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SCxDQUFULENBRUEsS0FBTWhDLENBQUFBLFdBQVcsMkJBQUcsNEJBQUFpQyxJQUFJLENBQUNJLFNBQUwsK0JBQWtCLEVBQWxCLENBQUgsQ0FBakIsQ0FMa0QseUJBT2xELElBQUssS0FBTUMsQ0FBQUEsQ0FBWCxHQUFnQkYsQ0FBQUEsR0FBaEIsQ0FBcUIsMEJBQ25CdkMsS0FBSyxDQUFDLENBQ0pDLEtBREksQ0FFSkMsSUFGSSxDQUFELENBR0YsQ0FDREUsSUFBSSxDQUFFcUMsQ0FBQyxDQUFDckMsSUFEUCxDQUVEQyxNQUFNLENBQUVvQyxDQUFDLENBQUNwQyxNQUZULENBR0RGLFdBSEMsQ0FIRSxDQUFMLENBUUQsQ0FFRDtBQUNBLEtBQU11QyxDQUFBQSxPQUFPLDJCQUFHLENBQUMsR0FBR3hDLElBQUksQ0FBQ3lDLE1BQUwsRUFBSixDQUFILENBQWIsQ0FDQSxLQUFNQyxDQUFBQSxRQUFRLDJCQUFHLEtBQU1DLENBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZSixPQUFPLENBQUNLLEdBQVIsQ0FBWSxLQUFNQyxDQUFBQSxHQUFOLEVBQWEsd0RBQUFBLENBQUFBLEdBQUcsQ0FBQzNCLE9BQUosQ0FBVyxDQUFwQyxDQUFaLENBQVQsQ0FBZCxDQXBCa0QseUJBc0JsRHVCLFFBQVEsQ0FBQ0ssT0FBVCxDQUFpQixDQUFDNUIsT0FBRCxDQUFVNkIsS0FBVixHQUFvQixrREFDbkNSLE9BQU8sQ0FBQ1EsS0FBRCxDQUFQLENBQWU3QixPQUFmLENBQXlCQSxPQUF6QixDQUNELENBRkQsRUF0QmtELHlCQTBCbEQsTUFBTyxDQUNMcEIsS0FESyxDQUVMQyxJQUZLLENBQVAsQ0FJRCxDQTlCRCxDLHlCQWdDQWlELE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQmxCLFlBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgdGFyID0gcmVxdWlyZSgndGFyJylcbmNvbnN0IG1pbmltYXRjaCA9IHJlcXVpcmUoJ21pbmltYXRjaCcpXG5cbmNvbnN0IG5vcm1hbGl6ZU1hdGNoID0gc3RyID0+IHN0clxuICAucmVwbGFjZSgvXFxcXCsvZywgJy8nKVxuICAucmVwbGFjZSgvXlxcLlxcL3xeXFwuLywgJycpXG5cbi8vIGZpbGVzIGFuZCByZWZzIGFyZSBtdXRhdGluZyBwYXJhbXNcbi8vIGZpbHRlckZpbGVzLCBpdGVtLCBwcmVmaXggYW5kIG9wdHMgYXJlIHJlYWQtb25seSBvcHRpb25zXG5jb25zdCB1bnRhciA9ICh7IGZpbGVzLCByZWZzIH0sIHsgZmlsdGVyRmlsZXMsIGl0ZW0sIHByZWZpeCB9KSA9PiB7XG4gIHRhci5saXN0KHtcbiAgICBmaWx0ZXI6IChwYXRoLCBlbnRyeSkgPT4ge1xuICAgICAgY29uc3QgZmlsZU1hdGNoID0gKCkgPT5cbiAgICAgICAgKCFmaWx0ZXJGaWxlcy5sZW5ndGggfHxcbiAgICAgICAgICBmaWx0ZXJGaWxlcy5zb21lKGYgPT4ge1xuICAgICAgICAgICAgY29uc3QgcGF0dGVybiA9IG5vcm1hbGl6ZU1hdGNoKGYpXG4gICAgICAgICAgICByZXR1cm4gbWluaW1hdGNoKFxuICAgICAgICAgICAgICBub3JtYWxpemVNYXRjaChwYXRoKSxcbiAgICAgICAgICAgICAgYHtwYWNrYWdlLyx9JHtwYXR0ZXJufWAsXG4gICAgICAgICAgICAgIHsgbWF0Y2hCYXNlOiBwYXR0ZXJuLnN0YXJ0c1dpdGgoJyonKSB9XG4gICAgICAgICAgICApXG4gICAgICAgICAgfSkpXG5cbiAgICAgIC8vIGV4cGFuZHMgdXNhZ2Ugb2Ygc2ltcGxlIHBhdGggZmlsdGVycywgZS5nOiBsaWIgb3Igc3JjL1xuICAgICAgY29uc3QgZm9sZGVyTWF0Y2ggPSAoKSA9PlxuICAgICAgICBmaWx0ZXJGaWxlcy5zb21lKGYgPT5cbiAgICAgICAgICBub3JtYWxpemVNYXRjaChwYXRoKS5zdGFydHNXaXRoKG5vcm1hbGl6ZU1hdGNoKGYpKSB8fFxuICAgICAgICAgIG5vcm1hbGl6ZU1hdGNoKHBhdGgpLnN0YXJ0c1dpdGgoYHBhY2thZ2UvJHtub3JtYWxpemVNYXRjaChmKX1gKSlcblxuICAgICAgaWYgKFxuICAgICAgICBlbnRyeS50eXBlID09PSAnRmlsZScgJiZcbiAgICAgICAgKGZpbGVNYXRjaCgpIHx8IGZvbGRlck1hdGNoKCkpXG4gICAgICApIHtcbiAgICAgICAgY29uc3Qga2V5ID0gcGF0aC5yZXBsYWNlKC9eW14vXStcXC8/LywgJycpXG4gICAgICAgIGZpbGVzLmFkZChrZXkpXG5cbiAgICAgICAgLy8gc2hvdWxkIHNraXAgcmVhZGluZyBmaWxlIHdoZW4gdXNpbmcgLS1uYW1lLW9ubHkgb3B0aW9uXG4gICAgICAgIGxldCBjb250ZW50XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgZW50cnkuc2V0RW5jb2RpbmcoJ3V0ZjgnKVxuICAgICAgICAgIGNvbnRlbnQgPSBlbnRyeS5jb25jYXQoKVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICAgICAgICB0aHJvdyBPYmplY3QuYXNzaWduKFxuICAgICAgICAgICAgbmV3IEVycm9yKCdmYWlsZWQgdG8gcmVhZCBmaWxlcycpLFxuICAgICAgICAgICAgeyBjb2RlOiAnRURJRkZVTlRBUicgfVxuICAgICAgICAgIClcbiAgICAgICAgfVxuXG4gICAgICAgIHJlZnMuc2V0KGAke3ByZWZpeH0ke2tleX1gLCB7XG4gICAgICAgICAgY29udGVudCxcbiAgICAgICAgICBtb2RlOiBgMTAwJHtlbnRyeS5tb2RlLnRvU3RyaW5nKDgpfWAsXG4gICAgICAgIH0pXG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG4gICAgfSxcbiAgfSlcbiAgICAub24oJ2Vycm9yJywgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8gZSA9PiB7XG4gICAgICB0aHJvdyBlXG4gICAgfSlcbiAgICAuZW5kKGl0ZW0pXG59XG5cbmNvbnN0IHJlYWRUYXJiYWxscyA9IGFzeW5jICh0YXJiYWxscywgb3B0cyA9IHt9KSA9PiB7XG4gIGNvbnN0IGZpbGVzID0gbmV3IFNldCgpXG4gIGNvbnN0IHJlZnMgPSBuZXcgTWFwKClcbiAgY29uc3QgYXJyID0gW10uY29uY2F0KHRhcmJhbGxzKVxuXG4gIGNvbnN0IGZpbHRlckZpbGVzID0gb3B0cy5kaWZmRmlsZXMgfHwgW11cblxuICBmb3IgKGNvbnN0IGkgb2YgYXJyKSB7XG4gICAgdW50YXIoe1xuICAgICAgZmlsZXMsXG4gICAgICByZWZzLFxuICAgIH0sIHtcbiAgICAgIGl0ZW06IGkuaXRlbSxcbiAgICAgIHByZWZpeDogaS5wcmVmaXgsXG4gICAgICBmaWx0ZXJGaWxlcyxcbiAgICB9KVxuICB9XG5cbiAgLy8gYXdhaXQgdG8gcmVhZCBhbGwgY29udGVudCBmcm9tIGluY2x1ZGVkIGZpbGVzXG4gIGNvbnN0IGFsbFJlZnMgPSBbLi4ucmVmcy52YWx1ZXMoKV1cbiAgY29uc3QgY29udGVudHMgPSBhd2FpdCBQcm9taXNlLmFsbChhbGxSZWZzLm1hcChhc3luYyByZWYgPT4gcmVmLmNvbnRlbnQpKVxuXG4gIGNvbnRlbnRzLmZvckVhY2goKGNvbnRlbnQsIGluZGV4KSA9PiB7XG4gICAgYWxsUmVmc1tpbmRleF0uY29udGVudCA9IGNvbnRlbnRcbiAgfSlcblxuICByZXR1cm4ge1xuICAgIGZpbGVzLFxuICAgIHJlZnMsXG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSByZWFkVGFyYmFsbHNcbiJdfQ==